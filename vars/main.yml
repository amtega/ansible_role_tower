---
# Role variables

# =============================================================================
# Common tower vars
# =============================================================================

# Version to install

tower_version_to_install: "{{ lookup('template', 'version.yml.j2') | trim }}"

# Facts path

tower_facts_file_path: /etc/ansible/facts.d/tower.fact

# Tower settings file path

tower_settings_path: /etc/tower/settings.py

# Repositories directory

tower_awx_repos_dir: /etc/yum.repos.d

# =============================================================================
# RH tower vars
# =============================================================================

# Offical tower repository settings

tower_rh_repo_url: https://releases.ansible.com/ansible-tower/setup-bundle/

# Artifact variables

tower_rh_package_regexp: >-
  {{ "ansible-tower-setup-bundle-[0-9.-]+\.el"
     + ansible_facts.distribution_major_version
     + "\.tar.gz" }}

tower_rh_default_artifact:
  type: https
  host: >-
    {{ tower_rh_repo_url | urlsplit('scheme')
       + "://"
       + tower_rh_repo_url | urlsplit('hostname') }}
  path: "{{ tower_rh_repo_url | urlsplit('path') }}"
  file: >-
    {{ "ansible-tower-setup-bundle-"
       + tower_version_to_install
       + ".el"
       + ansible_facts.distribution_major_version | string
       + ".tar.gz" }}
  dest: /tmp
  no_log: no

tower_rh_artifact_overrides:
  id: tower
  unarchive: yes

tower_rh_artifact_overriden: >-
  {{ tower_artifact
     | default(tower_rh_default_artifact)
     | combine(tower_rh_artifact_overrides) }}


tower_rh_uninstall_paths:
  - /usr/lib/rabbitmq
  - /var/lib/rabbitmq
  - /var/log/rabbitmq
  - /var/lib/awx
  - /opt/awx
  - /etc/tower
  - /var/log/tower

# =============================================================================
# AWX tower vars
# =============================================================================

# AWX repository file

tower_awx_repo_file: ansible-awx.repo

# AWX rabbitmq repository settings

tower_awx_rabbitmq_server_repo_url: >-
  https://dl.bintray.com/rabbitmq/rpm/rabbitmq-server/v3.7.x/el/7/
tower_awx_rabbitmq_erlang_repo_url: >-
   https://dl.bintray.com/rabbitmq-erlang/rpm/erlang/21/el/7/

tower_awx_rabbitmq_server_repo_file: rabbitmq.repo
tower_awx_rabbitmq_erlang_repo_file: rabbitmq-erlang.repo

# AWX required packages

tower_awx_required_packages:
  - rabbitmq-server
  - rh-git29
  - rh-postgresql10
  - memcached
  - nginx
  - nginx-filesystem
  - rh-python36

# AWX python settings

tower_awx_python_packages_pattern: >-
  rh-python36* rh-git29* rh-postgresql10* centos-release-scl httpd24-runtime
  scl-utils
tower_awx_python_enable_repo_option: >-
  copr:copr.fedorainfracloud.org:mrmeee:ansible-awx, base
tower_awx_python_excludes: "*-debuginfo"

# Erlang package

tower_awx_erlang_package: erlang

# AWX package

tower_awx_package: "ansible-awx-{{ tower_version }}"

# nginx settings

tower_awx_nginx_config_dir: /etc/nginx/
tower_awx_nginx_config_file:  nginx.conf

# PostgreSQL data dir

tower_awx_postgresql10_data_dir: /var/opt/rh/rh-postgresql10/lib/pgsql/data

# Stuff to clean when uninstalling awx

tower_awx_uninstall_paths:
  - "{{ tower_awx_postgresql10_data_dir }}"
  - /usr/lib/rabbitmq
  - /var/lib/rabbitmq
  - /var/log/rabbitmq
  - /etc/systemd/system/multi-user.target.wants/rabbitmq-server.service
  - /var/lib/awx
  - /opt/awx
  - /usr/bin/awx-cli
  - /etc/tower
  - /var/log/tower
  - /usr/bin/tower-cli
  - /opt/rh
